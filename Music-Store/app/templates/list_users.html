{% extends 'layout.html'%}

{%block title%} All Users {%endblock%}

{%block content%}

<div class="container">
    <h3> All Users</h3>
    <form method="get" class="d-flex justify-content-end mb-3">
    <input type="text" 
           class="form-control me-2" 
           placeholder="Search..."
           name="search"
           style="width: 200px;">
    <button class="btn btn-primary btn-sm">Search</button>
</form>
    <hr>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">username</th>
                <th scope="col">email</th>
                <th scope="col">is_verified</th>
                <th scope="col">role</th>
                <th scope="col">Edit Role</th>
                <th scope="col">Delete</th>

            </tr>
        </thead>
        <tbody>
            {% for user in users.items %}
            <tr>
                <th scope="row">{{loop.index}}</th>
                <td>{{ user.first_name }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{%if user.is_verified%} ✅
                    {%else%} ❎
                    {%endif%}

                </td>
                <td>{{ user.role }}</td>
                <td>
                    <form action="{{ url_for('update_user', user_id=user.id) }}" method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Update this Role?')">
                            Update
                        </button>
                    </form>
                </td> 
                <td>
                    <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Delete this user?')">
                            Delete
                        </button>
                    </form>
                </td> 
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<nav>
    <ul class="pagination justify-content-center">

        {% if users.has_prev %}
        <li class="page-item">
            <a class="page-link" href="?page={{ users.prev_num }}&search={{ search }}">Previous</a>
        </li>
        {% endif %}

        {% for p in users.iter_pages() %}
        {% if p %}
        <li class="page-item {% if p == users.page %}active{% endif %}">
            <a class="page-link" href="?page={{ p }}&search={{ search }}">{{ p }}</a>
        </li>
        {% endif %}
        {% endfor %}

        {% if users.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ users.next_num }}&search={{ search }}">Next</a>
        </li>
        {% endif %}

    </ul>
</nav>

{%endblock%}